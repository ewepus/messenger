<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="fragments/head"/>
<body>
<div th:replace="fragments/navbar"></div>
<main class="container">
    <hgroup>
        <h1>Ваши чаты</h1>
    </hgroup>

    <div th:if="${successMessage}" style="padding: 1rem; margin-bottom: 1rem; background-color: var(--pico-ins-color); border-radius: var(--pico-border-radius);">
        <p th:text="${successMessage}" style="margin: 0; color: white;"></p>
    </div>

    <table role="grid">
        <thead>
        <tr>
            <th>ID</th>
            <th>Участники</th>
            <th sec:authorize="hasRole('ADMIN')">Статус</th>
            <th>Название</th>
            <th>Действия</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="chat, iterStat : ${chats}">
            <td th:text="${chat.id}"></td>
            <td th:text="${chat.getUsers().get(0).getUsername()} + ', ' + ${chat.getUsers().get(1).getUsername()}"></td>
            <td sec:authorize="hasRole('ADMIN')" th:text="${chat.getStatus()}"></td>
            <td th:text="${chat.name}"></td>
            <td>
                <a th:href="@{/chats/chat/{name}(name=${chat.name})}"
                   role="button"
                   class="outline btn-xs">
                    Открыть
                </a>
                <a th:href="@{/chats/chat-delete/{name}(name=${chat.name})}"
                   role="button"
                   class="secondary"
                   onclick="return confirm('Вы уверены, что хотите удалить этот чат?')">
                    Удалить
                </a>
                <a sec:authorize="hasRole('ADMIN')"
                   th:href="@{/chats/chat-restore/{name}(name=${chat.name})}"
                   role="button"
                   class="secondary"
                   onclick="return confirm('Вы уверены, что хотите восстановить этот чат?')">
                    Восстановить
                </a>
            </td>
        </tr>
        </tbody>
    </table>

    <p th:if="${#lists.isEmpty(chats)}" class="text-center">
        <em>Пусто! <a href="/users/all">Найдите с кем начать общаться</a></em>
    </p>
</main>
<footer th:replace="fragments/footer"></footer>
</body>
</html>